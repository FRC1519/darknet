#!/bin/bash

declare -a make_args=(-j$(($(nproc) + 2)))
declare sudo
declare ip
if [[ $(hostname) == robin ]]; then
    make_args+=(GPU=0 CUDNN=0)
    sudo=""
    ip="192.168.0.252"
elif [[ $(hostname) == tegra-ubuntu ]]; then
    sudo="sudo"
    oper_ip="192.168.0.51"
    robot_ip="192.168.0.254" # Nowhere
else
    echo "Unrecognized host"
    exit 1
fi
[[ $DEBUG -gt 0 ]] && make_args+=(DEBUG=1)

ulimit -c unlimited
set -x
make "${make_args[@]}" && $sudo env GST_DEBUG=${GST_DEBUG:-2} ./robot --thresh 0.05 --camera 0 --fps "15/1" --stream-fps "15/1" --bitrate 750000 --oper-ip "$oper_ip" --robot-ip "$robot_ip" cfg/obj.data cfg/tiny-yolo-obj.cfg backup/tiny-yolo-obj.backup
