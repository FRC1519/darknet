#!/bin/bash

declare -a make_args=(-j$(($(nproc) + 2)))
declare sudo
declare ip
if [[ $(hostname) == robin ]]; then
    make_args+=(GPU=0 CUDNN=0)
    sudo=""
    ip="192.168.0.252"
elif [[ $(hostname) == tegra-ubuntu ]]; then
    sudo="sudo"
    ip="192.168.0.44"
else
    echo "Unrecognized host"
    exit 1
fi
[[ $DEBUG -gt 0 ]] && make_args+=(DEBUG=1)

make "${make_args[@]}" && $sudo env GST_DEBUG=${GST_DEBUG:-2} ./robot --camera 0 --width 640 --height 480 --fps "30/1" --ip "$ip" --port 9999 cfg/obj.data cfg/tiny-yolo-obj2.cfg backup/tiny-yolo-obj2_4600.weights
